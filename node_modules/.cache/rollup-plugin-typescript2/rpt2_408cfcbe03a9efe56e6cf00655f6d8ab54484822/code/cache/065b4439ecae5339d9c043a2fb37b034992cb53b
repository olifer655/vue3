{"code":"// 需要比对属性 diff算法    属性比对前后值\r\nfunction patchClass(el, value) {\r\n    if (value == null) {\r\n        el.removeAttribute('class');\r\n    }\r\n    else {\r\n        el.className = value;\r\n    }\r\n}\r\nfunction patchStyle(el, prev, next) {\r\n    const style = el.style; // 操作的是样式\r\n    // 最新的肯定要全部加到元素上\r\n    for (let key in next) {\r\n        style[key] = next[key];\r\n    }\r\n    // 新的没有 但是老的有这个属性, 将老的移除掉\r\n    if (prev) {\r\n        for (let key in prev) {\r\n            if (next[key] == null) {\r\n                style[key] = null;\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction createInvoker(value) {\r\n    const invoker = (e) => {\r\n        invoker.value(e);\r\n    };\r\n    invoker.value = value; // 存储这个变量, 后续想换绑 可以直接更新value值\r\n    return invoker;\r\n}\r\nfunction patchEvent(el, key, nextValue) {\r\n    // vei  vue event invoker  缓存绑定的事件 \r\n    const invokers = el._vei || (el._vei = {}); // 在元素上绑定一个自定义属性 用来记录绑定的事件\r\n    let exisitingInvoker = invokers[key]; // 先看一下有没有绑定过这个事件\r\n    if (exisitingInvoker && nextValue) { // 换绑逻辑\r\n        exisitingInvoker.value = nextValue;\r\n    }\r\n    else {\r\n        const name = key.slice(2).toLowerCase(); // eventName\r\n        if (nextValue) {\r\n            const invoker = invokers[key] = createInvoker(nextValue); // 返回一个引用\r\n            el.addEventListener(name, invoker); // 正规的时间 onClick =(e)=>{}\r\n        }\r\n        else if (exisitingInvoker) {\r\n            // 如果下一个值没有 需要删除\r\n            el.removeEventListener(name, exisitingInvoker);\r\n            invokers[key] = undefined; // 解绑了\r\n        }\r\n        // else{\r\n        //     // 压根没有绑定过 事件就不需要删除了\r\n        // }\r\n    }\r\n}\r\nfunction patchAttr(el, key, value) {\r\n    if (value == null) {\r\n        el.removeAttribute(key);\r\n    }\r\n    else {\r\n        el.setAttribute(key, value);\r\n    }\r\n}\r\nexport const patchProp = (el, key, prevValue, nextValue) => {\r\n    if (key === 'class') { // 类名 \r\n        patchClass(el, nextValue); // \r\n    }\r\n    else if (key === 'style') { // 样式\r\n        patchStyle(el, prevValue, nextValue);\r\n    }\r\n    else if (/^on[^a-z]/.test(key)) { // onXxx\r\n        // 如果有事件 addEventListener  如果没事件 应该用removeListener\r\n        patchEvent(el, key, nextValue);\r\n        // 绑定一个 换帮了一个  在换绑一个\r\n    }\r\n    else {\r\n        // 其他属性 setAttribute\r\n        patchAttr(el, key, nextValue);\r\n    }\r\n};\r\n//# sourceMappingURL=patchProp.js.map","references":[],"map":"{\"version\":3,\"file\":\"patchProp.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/runtime-dom/src/patchProp.ts\"],\"names\":[],\"mappings\":\"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\"}"}
