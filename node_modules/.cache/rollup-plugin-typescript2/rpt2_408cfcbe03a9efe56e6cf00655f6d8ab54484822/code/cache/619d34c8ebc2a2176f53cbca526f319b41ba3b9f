{"code":"import { isObject } from \"@vue/shared\";\r\nimport { track, trigger } from \"./effect\";\r\nconst mutableHandlers = {\r\n    get(target, key, recevier) {\r\n        if (key === \"__v_isReactive\" /* IS_REACTIVE */) {\r\n            return true;\r\n        }\r\n        track(target, key);\r\n        // 这里取值了， 可以收集他在哪个effect中\r\n        const res = Reflect.get(target, key, recevier); // target[key]\r\n        return res;\r\n    },\r\n    set(target, key, value, recevier) {\r\n        let oldValue = target[key];\r\n        // 如果改变值了， 可以在这里触发effect更新\r\n        const res = Reflect.set(target, key, value, recevier); // target[key] = value\r\n        if (oldValue !== value) { // 值不发生变化 effect不需要重新执行\r\n            trigger(target, key); // 找属性对应的effect让她重新执行\r\n        }\r\n        return res;\r\n    }\r\n};\r\n// map和weakMap的区别\r\nconst reactiveMap = new WeakMap(); // weakmap 弱引用   key必须是对象，如果key没有被引用可以被自动销毁\r\nfunction createReactiveObject(target) {\r\n    // 先默认认为这个target已经是代理过的属性了\r\n    if (target[\"__v_isReactive\" /* IS_REACTIVE */]) {\r\n        return target;\r\n    }\r\n    // reactiveApi 只针对对象才可以 \r\n    if (!isObject(target)) {\r\n        return target;\r\n    }\r\n    const exisitingProxy = reactiveMap.get(target); // 如果缓存中有 直接使用上次代理的结果\r\n    if (exisitingProxy) {\r\n        return exisitingProxy;\r\n    }\r\n    const proxy = new Proxy(target, mutableHandlers); // 当用户获取属性 或者更改属性的时候 我能劫持到\r\n    reactiveMap.set(target, proxy); // 将原对象和生成的代理对象 做一个映射表\r\n    return proxy; // 返回代理\r\n}\r\nexport function reactive(target) {\r\n    return createReactiveObject(target);\r\n}\r\nexport function toReactive(value) {\r\n    return isObject(value) ? reactive(value) : value;\r\n}\r\n// readonly shallowReactive shallowReadnly \r\n// export function readonly(){\r\n// }\r\n// export function shallowReactive(){\r\n// }\r\n// export function shallowReadnly(){\r\n// }\r\n//# sourceMappingURL=reactive.js.map","references":["C:/Users/test1/Desktop/vue-topic/vue-train-5/packages/shared/src/index.ts","C:/Users/test1/Desktop/vue-topic/vue-train-5/packages/reactivity/src/effect.ts"],"map":"{\"version\":3,\"file\":\"reactive.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/reactive.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,aAAa,CAAA;AACtC,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,UAAU,CAAC;AAM1C,MAAM,eAAe,GAAmC;IACpD,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ;QACrB,IAAI,GAAG,uCAA8B,EAAE;YACnC,OAAO,IAAI,CAAC;SACf;QACD,KAAK,CAAC,MAAM,EAAC,GAAG,CAAC,CAAC;QAClB,yBAAyB;QACzB,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC,CAAC,cAAc;QAC9D,OAAO,GAAG,CAAC;IACf,CAAC;IACD,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ;QAE5B,IAAI,QAAQ,GAAI,MAAc,CAAC,GAAG,CAAC,CAAA;QACnC,0BAA0B;QAC1B,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,sBAAsB;QAE7E,IAAG,QAAQ,KAAK,KAAK,EAAC,EAAE,uBAAuB;YAC3C,OAAO,CAAC,MAAM,EAAC,GAAG,CAAC,CAAC,CAAC,qBAAqB;SAC7C;QACD,OAAO,GAAG,CAAC;IACf,CAAC;CACJ,CAAA;AACD,iBAAiB;AACjB,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC,CAAC,2CAA2C;AAE9E,SAAS,oBAAoB,CAAC,MAAc;IACxC,0BAA0B;IAC1B,IAAK,MAAc,oCAA2B,EAAE;QAC5C,OAAO,MAAM,CAAA;KAChB;IACD,wBAAwB;IACxB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;QACnB,OAAO,MAAM,CAAA;KAChB;IACD,MAAM,cAAc,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,qBAAqB;IACrE,IAAI,cAAc,EAAE;QAChB,OAAO,cAAc,CAAA;KACxB;IACD,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC,CAAC,0BAA0B;IAC5E,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,sBAAsB;IAEtD,OAAO,KAAK,CAAC,CAAC,OAAO;AACzB,CAAC;AAED,MAAM,UAAU,QAAQ,CAAC,MAAc;IACnC,OAAO,oBAAoB,CAAC,MAAM,CAAC,CAAA;AACvC,CAAC;AACD,MAAM,UAAU,UAAU,CAAC,KAAK;IAC5B,OAAO,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAA;AACpD,CAAC;AAED,2CAA2C;AAC3C,8BAA8B;AAC9B,IAAI;AACJ,qCAAqC;AACrC,IAAI;AACJ,oCAAoC;AACpC,IAAI\"}"}
