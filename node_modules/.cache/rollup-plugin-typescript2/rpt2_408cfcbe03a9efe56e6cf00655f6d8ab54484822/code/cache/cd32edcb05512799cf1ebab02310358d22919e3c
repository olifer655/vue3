{"code":"import { isFunction } from \"@vue/shared\";\r\nimport { isTracking, ReactiveEffect, trackEffects, triggerEffects } from \"./effect\";\r\nclass ComputedRefImpl {\r\n    constructor(getter, setter) {\r\n        this.setter = setter;\r\n        this._dirty = true; // this._dirty = true;\r\n        this.__v_isRef = true;\r\n        // 这里将计算属性包成一个effect\r\n        // 这里 我给计算属性变成了effect ，那么计算属性中的属性会收集这个effect\r\n        this.effect = new ReactiveEffect(getter, () => {\r\n            // 稍后计算属性依赖的值变化 不要重新执行计算属性的effect，而是调用此函数\r\n            if (!this._dirty) {\r\n                this._dirty = true;\r\n                triggerEffects(this.dep);\r\n            }\r\n        });\r\n    }\r\n    get value() {\r\n        if (isTracking()) { // 是否是在effect中取值的\r\n            trackEffects(this.dep || (this.dep = new Set));\r\n        }\r\n        if (this._dirty) {\r\n            // 将结果缓存到this._value 这样就不用每次都run了\r\n            this._value = this.effect.run();\r\n            this._dirty = false;\r\n        }\r\n        return this._value;\r\n    }\r\n    set value(newValue) {\r\n        this.setter(newValue); // 如果修改计算属性的值 就触发你自己的set方法\r\n    }\r\n}\r\nexport function computed(getterOrOptions) {\r\n    const onlyGetter = isFunction(getterOrOptions);\r\n    let getter;\r\n    let setter;\r\n    if (onlyGetter) {\r\n        getter = getterOrOptions;\r\n        setter = () => { };\r\n    }\r\n    else {\r\n        getter = getterOrOptions.get;\r\n        setter = getterOrOptions.set;\r\n    }\r\n    return new ComputedRefImpl(getter, setter);\r\n}\r\n//# sourceMappingURL=computed.js.map","references":["C:/Users/test1/Desktop/vue-topic/vue-train-5/packages/shared/src/index.ts","C:/Users/test1/Desktop/vue-topic/vue-train-5/packages/reactivity/src/effect.ts"],"map":"{\"version\":3,\"file\":\"computed.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/computed.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,aAAa,CAAC;AACzC,OAAO,EAAE,UAAU,EAAE,cAAc,EAAE,YAAY,EAAE,cAAc,EAAE,MAAM,UAAU,CAAC;AAGpF,MAAM,eAAe;IAMjB,YAAY,MAAM,EAAS,MAAM;QAAN,WAAM,GAAN,MAAM,CAAA;QAJ1B,WAAM,GAAG,IAAI,CAAC,CAAC,sBAAsB;QACrC,cAAS,GAAG,IAAI,CAAC;QAIpB,oBAAoB;QACpB,4CAA4C;QAC5C,IAAI,CAAC,MAAM,GAAG,IAAI,cAAc,CAAC,MAAM,EAAC,GAAE,EAAE;YACxC,yCAAyC;YACzC,IAAG,CAAC,IAAI,CAAC,MAAM,EAAC;gBACZ,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;gBACnB,cAAc,CAAC,IAAI,CAAC,GAAG,CAAE,CAAA;aAC5B;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IACD,IAAI,KAAK;QACL,IAAI,UAAU,EAAE,EAAE,EAAE,iBAAiB;YACjC,YAAY,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,IAAI,GAAG,CAAC,CAAC,CAAA;SACjD;QACD,IAAI,IAAI,CAAC,MAAM,EAAE;YACb,iCAAiC;YACjC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;YAChC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SACvB;QACD,OAAO,IAAI,CAAC,MAAM,CAAC;IACvB,CAAC;IACD,IAAI,KAAK,CAAC,QAAQ;QACd,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,0BAA0B;IACrD,CAAC;CACJ;AACD,MAAM,UAAU,QAAQ,CAAC,eAAe;IACpC,MAAM,UAAU,GAAG,UAAU,CAAC,eAAe,CAAC,CAAC;IAC/C,IAAI,MAAM,CAAC;IACX,IAAI,MAAM,CAAC;IACX,IAAI,UAAU,EAAE;QACZ,MAAM,GAAG,eAAe,CAAC;QACzB,MAAM,GAAG,GAAG,EAAE,GAAG,CAAC,CAAA;KACrB;SAAM;QACH,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC;QAC7B,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC;KAChC;IAED,OAAO,IAAI,eAAe,CAAC,MAAM,EAAE,MAAM,CAAC,CAAA;AAC9C,CAAC\"}"}
